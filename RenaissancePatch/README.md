# Renaissance Patch

DLL библиотека для встраивания внутри клиента Mail.Ru Agent. Поддерживается всеми версиями Агента, и, возможно, сторонними программами тоже.

## Как он работает?

С помощью сторонней библиотеки Minhook оно подменяет работу функции `gethostbyname` из Winsock2, которым пользуется Mail.Ru Agent. Программа обращается к ней только 2-3 раза за сессию, но этого хватает, чтобы подменить встроенный ныне умершего сервера MRIM протокола на свои.

## TODO

- Добавить поддержку Cmake и GCC

## Требования для компиляции

* Visual Studio 2022 любой редакции
* Windows 10 SDK (можно установить в Visual Studio Installer)
* C++ Windows XP Support for VS 2017 (v141) tools (можно установить в Visual Studio Installer)

## Минимальные требования для работы патча

При сборке через MSVC:

* Windows XP SP3
* Visual Studio 2017 redist

При сборке через GCC/cmake:

_TBD_

## Встраивание в свою копию Mail.ru Agent

### Автоматически

_TBD_

### Ручной способ

0. Установить Mail.ru Агент, после завершения установки снять галочку "Запустить программу"
1. Скачать **CFF Explorer**
2. Открыть `magent.exe` в Program Files
3. Открыть раздел "Import Adder"
4. Нажать на кнопку "Add" и выбрать скомпилированный или готовый DLL файл
5. Нажать на "Import By Ordinal", и потом на "Rebuild Import Table"
6. Сохранить файл
7. Если вылезет уведомление о успешной установке патча, значит, всё работает

## Настройка патча

Патч настраивается через Редактор Реестра. После инициализации патча создаются ключи реестра по пути `HKEY_CURRENT_USER\Software\Renaissance`:

- `MrimDomain` - Домен или IP адрес заменяющего сервера (БЕЗ УКАЗАНИЯ ПОРТА!)
- `MrimAvatarDomain` - Домен или IP адрес сервера аватарок (также, без порта)
